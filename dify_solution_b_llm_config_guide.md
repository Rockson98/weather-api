# Dify Solution B - LLM节点配置指南（方法二）

## 🎯 配置方案：数据合并节点 + LLM节点

### 📋 节点配置步骤

#### 1. **添加数据合并节点**
- 在Dify工作流中添加一个**代码节点**
- 将代码内容设置为 `dify_solution_b_data_merger.py` 的内容
- 配置输入变量：

| 变量名 | 来源节点 | 字段名 | 描述 |
|--------|----------|--------|------|
| `city` | 主数据处理节点 | `city` | 城市名称 |
| `weather_broadcast` | 天气播报节点 | `weather_broadcast` | 天气播报内容 |
| `prose_prompt` | 散文生成节点 | `prose_prompt` | 散文提示词 |
| `prose_context` | 散文生成节点 | `prose_context` | 散文上下文 |

#### 2. **配置LLM节点**
- 添加LLM节点
- 连接到数据合并节点
- 配置输入变量：

| 变量名 | 来源节点 | 字段名 | 描述 |
|--------|----------|--------|------|
| `full_prompt` | 数据合并节点 | `full_prompt` | 完整的LLM提示词 |

#### 3. **LLM节点提示词配置**
由于数据合并节点已经构建了完整的提示词，LLM节点的提示词可以简化为：

```
{{full_prompt}}
```

或者直接设置为空，让数据合并节点提供的提示词生效。

### 🔗 完整节点连接关系

```
主数据处理节点
    ├── 天气播报节点 (branch1)
    ├── 散文生成节点 (branch2)
    └── 数据合并节点 (接收两个分支的输出)
        └── LLM节点 (接收合并后的提示词)
            └── 输出：text + string
```

### 📝 数据合并节点输出变量

| 变量名 | 数据类型 | 描述 |
|--------|---------|------|
| `full_prompt` | `string` | 完整的LLM提示词 |
| `city` | `string` | 城市名称 |
| `weather_broadcast` | `string` | 天气播报内容 |
| `prose_prompt` | `string` | 散文提示词 |
| `prose_context` | `string` | 散文上下文 |
| `simple_context` | `string` | 简化的调试信息 |
| `task_type` | `string` | 任务类型标识 |
| `output_format` | `string` | 输出格式说明 |

### 🎯 LLM节点输出配置

#### 方案A：完整输出
- **text输出**：完整的天气播报+散文内容
- **string输出**：与text相同

#### 方案B：分离输出
- **text输出**：完整的天气播报+散文内容
- **string输出**：只包含散文部分

### 🔧 配置检查清单

- [ ] 数据合并节点正确连接到主数据处理节点
- [ ] 天气播报节点连接到主数据处理节点
- [ ] 散文生成节点连接到主数据处理节点
- [ ] 数据合并节点接收4个输入变量
- [ ] LLM节点接收 `full_prompt` 输入
- [ ] LLM节点配置了合适的模型参数
- [ ] 输出格式符合预期

### 🚀 测试建议

1. **单步测试**：先测试数据合并节点，确保输出正确
2. **完整测试**：测试整个工作流，检查最终输出
3. **参数调优**：根据输出质量调整LLM参数

### 💡 优势

- **灵活性**：可以轻松修改提示词模板
- **可维护性**：代码逻辑清晰，易于调试
- **扩展性**：可以轻松添加新的数据处理逻辑
- **兼容性**：适用于各种Dify版本

### 🔍 故障排除

如果遇到问题，请检查：
1. 节点连接是否正确
2. 输入变量名称是否匹配
3. 代码节点是否有语法错误
4. LLM节点是否接收到正确的输入
